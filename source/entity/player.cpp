#include "player.h"
#include <nothofagus.h>
#include <iostream>

namespace Entity
{

PlayerEntity::PlayerEntity(Nothofagus::Canvas& canvas, glm::vec2 position) :
    AnimatedEntity(
        canvas, {32, 32}, position,
        {
            { 0.5607843137254902, 0.592156862745098, 0.2901960784313726, 1.0 },
            { 0.00392156862745098, 0.00392156862745098, 0.00392156862745098, 1.0 },
            { 1.0, 0.0, 0.0, 1.0 },
            { 0.0, 0.0, 0.0392156862745098, 1.0 },
            { 0.596078431372549, 0.596078431372549, 0.023529411764705882, 1.0 },
            { 0.3137254901960784, 0.3137254901960784, 0.5411764705882353, 1.0 },
            { 0.0, 0.6274509803921569, 0.0, 1.0 },
            { 1.0, 0.0, 1.0, 1.0 },
            { 0.0, 0.0, 0.0, 1.0 },
            { 0.0, 0.0, 1.0, 1.0 },
            { 0.0, 0.0, 0.0, 0.0 },
        },
        {
            {
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,2,2,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,2,7,7,2,2,2,2,7,7,2,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,2,2,2,2,7,7,7,7,2,2,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,2,2,2,4,1,4,4,8,4,2,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,4,4,1,4,4,8,4,4,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,4,4,4,4,4,4,4,4,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,4,4,4,4,4,4,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,2,9,5,5,5,5,9,2,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,2,2,9,9,9,9,9,9,2,2,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,2,2,9,9,9,9,9,9,2,2,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,2,2,2,9,9,9,9,9,9,2,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,2,2,8,9,9,9,9,9,9,8,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,2,2,8,9,9,9,9,9,9,8,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,9,9,9,9,9,9,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,6,9,8,8,9,6,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,6,6,8,8,6,6,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            },
            {
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,9,9,2,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,7,7,7,7,7,7,2,2,2,2,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,7,7,7,7,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,4,8,4,4,8,2,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,4,4,4,4,8,4,4,8,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,4,4,4,4,4,4,4,4,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,8,8,8,10,4,4,4,4,4,4,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,9,2,2,9,5,5,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,2,2,2,9,9,9,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,2,2,9,9,9,9,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,8,8,8,8,8,2,2,2,9,9,9,9,2,2,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,8,8,8,8,2,2,9,9,9,9,9,2,2,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,8,8,8,8,2,2,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,9,9,9,9,9,9,8,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,6,9,8,8,9,6,8,8,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,8,8,6,6,8,8,6,6,8,8,8,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,8,8,8,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            },
            {
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,9,9,2,2,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,2,7,7,7,7,7,7,7,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,7,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,2,2,2,2,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,2,2,2,2,2,2,8,4,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,4,4,4,4,4,8,0,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,4,4,4,4,4,4,4,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,4,4,4,4,4,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,2,2,9,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,2,2,9,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,2,2,9,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,2,2,9,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,9,2,2,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,8,8,8,8,3,9,9,2,2,8,8,8,8,8,8,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,3,9,9,3,8,8,8,8,8,8,8,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,3,6,6,3,8,8,8,8,8,8,8,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,3,6,6,3,8,8,8,8,8,8,8,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,8,8,8,8,8,8,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
            }
        }

    ), updated(false)
{
    state = PlayerState::IDLE;
};

void PlayerEntity::setupController(Nothofagus::Controller& controller)
{
    controller.registerAction({ Nothofagus::Key::A, Nothofagus::DiscreteTrigger::Press }, [&]()
    {
        state = PlayerState::Left;
        updated = true;

    });
    controller.registerAction({ Nothofagus::Key::S, Nothofagus::DiscreteTrigger::Press }, [&]()
    {
        state = PlayerState::Down;
        updated = true;
    });
    controller.registerAction({ Nothofagus::Key::D, Nothofagus::DiscreteTrigger::Press }, [&]()
    {
        state = PlayerState::Right;
        updated = true;
    });
}

void PlayerEntity::update(Nothofagus::Canvas& canvas, float dt)
{
    if (updated)
    {
        switch (state)
        {
        case PlayerState::Left:
            canvas.bellota(currentBellotaId).depthOffset() = -1;
            currentBellotaId = this->bellotaIds[1];
            canvas.bellota(currentBellotaId).depthOffset() = 1;
            canvas.bellota(currentBellotaId).transform().scale().x = -abs(canvas.bellota(currentBellotaId).transform().scale().x);
            break;
        }
        updated = false;
        std::cout << state << std::endl;
    }
}

}